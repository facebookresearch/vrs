<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-ImageSupport" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Image Support | VRS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://facebookresearch.github.io/vrs/docs/ImageSupport"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Image Support | VRS"><meta data-rh="true" name="description" content="This page describes how VRS handles content blocks using the Datalayout Conventions."><meta data-rh="true" property="og:description" content="This page describes how VRS handles content blocks using the Datalayout Conventions."><link data-rh="true" rel="icon" href="/vrs/img/VRS-Icon.svg"><link data-rh="true" rel="canonical" href="https://facebookresearch.github.io/vrs/docs/ImageSupport"><link data-rh="true" rel="alternate" href="https://facebookresearch.github.io/vrs/docs/ImageSupport" hreflang="en"><link data-rh="true" rel="alternate" href="https://facebookresearch.github.io/vrs/docs/ImageSupport" hreflang="x-default"><link rel="stylesheet" href="/vrs/assets/css/styles.39b3626f.css">
<link rel="preload" href="/vrs/assets/js/runtime~main.1be27f1a.js" as="script">
<link rel="preload" href="/vrs/assets/js/main.131b4a2f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/vrs/"><div class="navbar__logo"><img src="/vrs/img/VRS-Icon.svg" alt="VRS Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/vrs/img/VRS-Icon.svg" alt="VRS Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">VRS</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/vrs/docs/Overview">Documentation</a><a href="/vrs/doxygen/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">C++ API Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/facebookresearch/vrs#getting-started" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Build Instructions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookresearch/vrs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/Overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/Organization">Organization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/FileStructure">File Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/FileCreation">File Creation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/FilePlayback">File Playback</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/RecordFormat">Record Format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/vrs/docs/ImageSupport">Image Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/FileHandler">The FileHandler Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/VrsCliTool">The vrs Command Line Tool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/vrsplayer">The vrsplayer App</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/vrs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Image Support</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Image Support</h1></header><p><em>This page describes how VRS handles content blocks using the Datalayout Conventions.</em></p><p>Prerequisite: Understanding how <code>RecordFormat</code> works.</p><p>Image content blocks can be any of the following different subtypes:</p><ul><li><code>image/raw</code><br>The image is stored as a buffer of raw pixels, which might a compacted pixel format such as <a href="https://developer.android.com/reference/android/graphics/ImageFormat#RAW10" target="_blank" rel="noopener noreferrer">RAW10</a>, but not compressed using a <code>PixelFormat</code>.<br>The exact <a href="https://github.com/facebookresearch/vrs/blob/main/vrs/RecordFormat.h#L49-L68" target="_blank" rel="noopener noreferrer">list of pixel formats</a> grows over time.</li><li><code>image/jpg</code> and <code>image/png</code><br>The image is compressed using jpeg or png compression. The payload of the image content block contains exactly what a jpg or png file would contain.</li><li><code>image/video</code><br>The image is compressed according to the spec of a video codec standard, such as H.264 or H.265.<br><em>Note that the list of supported video codecs is deliberately not part of the spec, but rather, is meant to be implementation dependent, part of a VRS extension. VRS Open Source does not currently provide any implementation.</em></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-image-properties">Additional Image Properties<a href="#additional-image-properties" class="hash-link" aria-label="Direct link to Additional Image Properties" title="Direct link to Additional Image Properties">​</a></h2><p>To be complete, image content blocks, in particular <code>image/raw</code> content blocks, may require the following complementary properties for an image:</p><ul><li>Resolution</li><li>Stride</li><li>Pixel format</li></ul><p>Without these properties, <code>image/raw</code> images cannot be interpreted safely. These properties can be provided in two distinct ways:</p><ul><li>The image properties can be part of the <code>RecordFormat</code> description itself, meaning that the records using that <code>RecordFormat</code> will all be using the exact same pixel format.<br>The content block description might look like this:<ul><li><code>image/raw/640x480/pixel=grey8</code></li><li><code>image/raw/640x480/pixel=yuv_i420_split/stride=640</code></li></ul></li><li>The image properties can be provided in the datalayout content block found either before the <code>image</code> content block in the same record, or in the stream’s last configuration record. When using this method, the properties must be specified using the <a href="https://github.com/facebookresearch/vrs/blob/main/vrs/DataLayoutConventions.h#L61-L64" target="_blank" rel="noopener noreferrer">Datalayout Conventions</a>, which are merely a collection of data types and labels to use in your <code>DataLayout</code> to specify properties.</li></ul><p>Whichever method you use, VRS collects the image properties for you, so that the <code>RecordFormatStreamPlayer::onImageRead()</code> callback can directly provide a content block object that you can query for the image format, regardless of how or where it was specified.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="specifying-additional-image-properties">Specifying Additional Image Properties<a href="#specifying-additional-image-properties" class="hash-link" aria-label="Direct link to Specifying Additional Image Properties" title="Direct link to Specifying Additional Image Properties">​</a></h3><p>For <code>image/raw</code> and <code>image/video</code> images, use a <a href="https://github.com/facebookresearch/vrs/blob/main/vrs/DataLayoutConventions.h#L59" target="_blank" rel="noopener noreferrer"><code>vrs::DataLayoutConventions::ImageSpec</code></a> to describe your image in a configuration record, or in a <code>DataLayout</code> block just before the image content block of your data records.</p><p>The <code>DataLayout</code> fields are:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> width</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageWidth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> height</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageHeight</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> stride</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageStride</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceEnum</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">PixelFormat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> pixelFormat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImagePixelFormat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// For image/video only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceString codecName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageCodecName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> codecQuality</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageCodecQuality</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// optional</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For <code>image/video</code> images, specify the keyframe timestamp and the keyframe index, using the following <code>DataLayout</code> fields:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token keyword" style="font-style:italic">double</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> keyFrameTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageKeyFrameTimeStamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> keyFrameIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageKeyFrameIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="image-format-differences">Image Format Differences<a href="#image-format-differences" class="hash-link" aria-label="Direct link to Image Format Differences" title="Direct link to Image Format Differences">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="imageraw"><code>image/raw</code><a href="#imageraw" class="hash-link" aria-label="Direct link to imageraw" title="Direct link to imageraw">​</a></h3><p>Without the following properties, <code>image/raw</code> image content blocks can not be interpreted:</p><ul><li>Required properties: width, height, pixel format.</li><li>Optional properties: stride.</li></ul><p>When properties are provided using the Datalayout Conventions, all additional properties must be provided by a single <code>DataLayout</code> structure in one record. For example, you must not put the pixel format in the configuration record, and then put the image dimensions in the data record. You must either put both the pixel format and the image dimensions in a configuration record&#x27;s <code>DataLayout</code>, or you must put them both in a <code>DataLayout</code> just before the image content block.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="imagejpg-and-imagepng"><code>image/jpg</code> and <code>image/png</code><a href="#imagejpg-and-imagepng" class="hash-link" aria-label="Direct link to imagejpg-and-imagepng" title="Direct link to imagejpg-and-imagepng">​</a></h3><p>jpg and png payloads are exactly the same as jpg and png files, which are fully self-described. Therefore, when those image formats are used, properties specified using the Datalayout Conventions are ignored by VRS.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="imagevideo"><code>image/video</code><a href="#imagevideo" class="hash-link" aria-label="Direct link to imagevideo" title="Direct link to imagevideo">​</a></h3><p><em>Support for <code>image/video</code> images is not ready for open sourcing at this time.</em></p><p>Video image content blocks require additional properties to decode images:</p><ul><li>Required properties: width, height, pixel format, codec name, keyframe timestamp, keyframe index.</li><li>Optional properties: compression quality, which may affect how to decode the image.</li></ul><p>Similar to <code>image/raw</code> images, pixel format and image dimension information must be provided in a single <code>DataLayout</code>, either in the configuration record or in the data record of the image. Typically, the pixel format and image resolution will not change without a configuration change. Therefore, they are best stored in a configuration record.<br>
<!-- -->On the other hand, the keyframe timestamp and the keyframe index properties change with every frame, and are therefore searched only in a <code>DataLayout</code> that must be immediately before the <code>image/video</code> content block.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reading-images">Reading Images<a href="#reading-images" class="hash-link" aria-label="Direct link to Reading Images" title="Direct link to Reading Images">​</a></h2><p>Image data is received by the <code>RecordFormatStreamPlayer::onImageRead()</code> callback:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">onImageRead</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> CurrentRecord</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> record</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    size_t blockIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> ContentBlock</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> contentBlock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>RecordFormatStreamPlayer::onDataLayoutRead()</code> callback happens <strong>after</strong> the <code>DataLayout</code> data has been read from disk.</p><p>The <code>RecordFormatStreamPlayer::onImageRead()</code> callback happens <strong>before</strong> any image data has been read. However, the provided <code>contentBlock</code> object holds all the image properties, so the following information can be found:</p><ul><li>For all types: the <code>contentBlock</code> size is known. That&#x27;s the size of the buffer you will need to read the image data stored in the image content block.</li><li>For <code>image/raw</code> images: the pixel format and resolution are defined.</li><li>For <code>image/video</code> images: the pixel format, resolution, keyframe timestamp, and keyframe index are defined.</li></ul><p>The image data itself can be read using the <code>RecordReader</code> object provided by the <code>CurrentRecord</code> object. The image is described by an <code>ImageContentBlockSpec</code> object provided by <code>contentBlock.image()</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="imageraw-images"><code>image/raw</code> images<a href="#imageraw-images" class="hash-link" aria-label="Direct link to imageraw-images" title="Direct link to imageraw-images">​</a></h3><p>Allocate or reuse a buffer where you can read the image data. Beware of the image’s stride, which is how it was when the image was saved.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="imagejpg-and-imagepng-images"><code>image/jpg</code> and <code>image/png</code> images<a href="#imagejpg-and-imagepng-images" class="hash-link" aria-label="Direct link to imagejpg-and-imagepng-images" title="Direct link to imagejpg-and-imagepng-images">​</a></h3><p>You will need to read and decode the compressed image data using a standard jpg or png library.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="imagevideo-images"><code>image/video</code> images<a href="#imagevideo-images" class="hash-link" aria-label="Direct link to imagevideo-images" title="Direct link to imagevideo-images">​</a></h3><p>Support for <code>image/video</code> images is not currently ready for open sourcing. Stay tuned!</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebookresearch/vrs/edit/main/website/docs/ImageSupport.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/vrs/docs/RecordFormat"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Record Format</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/vrs/docs/FileHandler"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">The FileHandler Interface</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#additional-image-properties" class="table-of-contents__link toc-highlight">Additional Image Properties</a><ul><li><a href="#specifying-additional-image-properties" class="table-of-contents__link toc-highlight">Specifying Additional Image Properties</a></li></ul></li><li><a href="#image-format-differences" class="table-of-contents__link toc-highlight">Image Format Differences</a><ul><li><a href="#imageraw" class="table-of-contents__link toc-highlight"><code>image/raw</code></a></li><li><a href="#imagejpg-and-imagepng" class="table-of-contents__link toc-highlight"><code>image/jpg</code> and <code>image/png</code></a></li><li><a href="#imagevideo" class="table-of-contents__link toc-highlight"><code>image/video</code></a></li></ul></li><li><a href="#reading-images" class="table-of-contents__link toc-highlight">Reading Images</a><ul><li><a href="#imageraw-images" class="table-of-contents__link toc-highlight"><code>image/raw</code> images</a></li><li><a href="#imagejpg-and-imagepng-images" class="table-of-contents__link toc-highlight"><code>image/jpg</code> and <code>image/png</code> images</a></li><li><a href="#imagevideo-images" class="table-of-contents__link toc-highlight"><code>image/video</code> images</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/vrs/docs/Overview">Documentation</a></li><li class="footer__item"><a href="https://github.com/facebookresearch/vrs/tree/main/sample_code" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sample Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal (continued)</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/vrs/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/vrs/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2024 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/vrs/assets/js/runtime~main.1be27f1a.js"></script>
<script src="/vrs/assets/js/main.131b4a2f.js"></script>
</body>
</html>