<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-ImageSupport" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Image Support | VRS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://facebookresearch.github.io/vrs/docs/ImageSupport"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Image Support | VRS"><meta data-rh="true" name="description" content="This page describes how VRS handles content blocks using the Datalayout Conventions."><meta data-rh="true" property="og:description" content="This page describes how VRS handles content blocks using the Datalayout Conventions."><link data-rh="true" rel="icon" href="/vrs/img/VRS-Icon.svg"><link data-rh="true" rel="canonical" href="https://facebookresearch.github.io/vrs/docs/ImageSupport"><link data-rh="true" rel="alternate" href="https://facebookresearch.github.io/vrs/docs/ImageSupport" hreflang="en"><link data-rh="true" rel="alternate" href="https://facebookresearch.github.io/vrs/docs/ImageSupport" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Image Support","item":"https://facebookresearch.github.io/vrs/docs/ImageSupport"}]}</script><link rel="stylesheet" href="/vrs/assets/css/styles.5fd31f72.css">
<script src="/vrs/assets/js/runtime~main.4a77ff41.js" defer="defer"></script>
<script src="/vrs/assets/js/main.b4e3528d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/vrs/"><div class="navbar__logo"><img src="/vrs/img/VRS-Icon.svg" alt="VRS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/vrs/img/VRS-Icon.svg" alt="VRS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">VRS</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/vrs/docs/Overview">Documentation</a><a href="/vrs/doxygen/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">C++ API Documentation<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/facebookresearch/vrs#getting-started" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Build Instructions<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/facebookresearch/vrs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/Overview"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/Organization"><span title="Organization" class="linkLabel_WmDU">Organization</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/FileStructure"><span title="File Structure" class="linkLabel_WmDU">File Structure</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/FileCreation"><span title="File Creation" class="linkLabel_WmDU">File Creation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/FilePlayback"><span title="File Playback" class="linkLabel_WmDU">File Playback</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/RecordFormat"><span title="Record Format" class="linkLabel_WmDU">Record Format</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/vrs/docs/ImageSupport"><span title="Image Support" class="linkLabel_WmDU">Image Support</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/FileHandler"><span title="The FileHandler Interface" class="linkLabel_WmDU">The FileHandler Interface</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/VrsCliTool"><span title="The vrs Command Line Tool" class="linkLabel_WmDU">The vrs Command Line Tool</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vrs/docs/vrsplayer"><span title="The vrsplayer App" class="linkLabel_WmDU">The vrsplayer App</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/vrs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Image Support</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Image Support</h1></header><p><em>This page describes how VRS handles content blocks using the Datalayout Conventions.</em></p>
<p>Prerequisite: Understanding how <code>RecordFormat</code> works.</p>
<p>Image content blocks can be any of the following different subtypes:</p>
<ul>
<li class=""><code>image/raw</code><br>
<!-- -->The image is stored as a buffer of raw pixels, which might a compacted pixel format such as <a href="https://developer.android.com/reference/android/graphics/ImageFormat#RAW10" target="_blank" rel="noopener noreferrer" class="">RAW10</a>, but not compressed using a <code>PixelFormat</code>.<br>
<!-- -->The exact <a href="https://github.com/facebookresearch/vrs/blob/main/vrs/RecordFormat.h#L63-L92" target="_blank" rel="noopener noreferrer" class="">list of pixel formats</a> grows over time.</li>
<li class=""><code>image/png</code>, <code>image/jpg</code>, <code>image/jxl</code>, and <code>image/custom_codec</code><br>
<!-- -->The image is compressed using png, jpeg, jpeg-xl, or a custom codec. The payload of the image content block contains exactly what regular file of that image type would contain<br>
<em>Note that when using a custom codec, you must specify a codec name, or the image content block will be reported as unsupported on read.</em></li>
<li class=""><code>image/video</code><br>
<!-- -->The image is compressed according to the spec of a video codec standard, such as H.264 or H.265.<br>
<em>Note that the list of supported video codecs is deliberately not part of the spec, but rather, is meant to be implementation dependent, by an extension. VRS Open Source provides the vrs/xprs module to interface with ffmpeg and expose the codecs it was built with.</em></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="additional-image-properties">Additional Image Properties<a href="#additional-image-properties" class="hash-link" aria-label="Direct link to Additional Image Properties" title="Direct link to Additional Image Properties" translate="no">​</a></h2>
<p>To be complete, image content blocks, in particular <code>image/raw</code> content blocks, may require the following complementary properties for an image:</p>
<ul>
<li class="">Resolution</li>
<li class="">Stride</li>
<li class="">Pixel format</li>
</ul>
<p>Without these properties, <code>image/raw</code> images cannot be interpreted safely. These properties can be provided in two distinct ways:</p>
<ul>
<li class="">The image properties can be part of the <code>RecordFormat</code> description itself, meaning that the records using that <code>RecordFormat</code> will all be using the exact same pixel format.<br>
<!-- -->The content block description might look like this:<!-- -->
<ul>
<li class=""><code>image/raw/640x480/pixel=grey8</code></li>
<li class=""><code>image/raw/640x480/pixel=yuv_i420_split/stride=640</code></li>
</ul>
</li>
<li class="">The image properties can be provided in the datalayout content block found either before the <code>image</code> content block in the same record, or in the stream’s last configuration record. When using this method, the properties must be specified using the <a href="https://github.com/facebookresearch/vrs/blob/main/vrs/DataLayoutConventions.h#L61-L64" target="_blank" rel="noopener noreferrer" class="">Datalayout Conventions</a>, which are merely a collection of data types and labels to use in your <code>DataLayout</code> to specify properties.</li>
</ul>
<p>Whichever method you use, VRS collects the image properties for you, so that the <code>RecordFormatStreamPlayer::onImageRead()</code> callback can directly provide a content block object that you can query for the image format, regardless of how or where it was specified.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="specifying-additional-image-properties">Specifying Additional Image Properties<a href="#specifying-additional-image-properties" class="hash-link" aria-label="Direct link to Specifying Additional Image Properties" title="Direct link to Specifying Additional Image Properties" translate="no">​</a></h3>
<p>For <code>image/raw</code> and <code>image/video</code> images, use a <a href="https://github.com/facebookresearch/vrs/blob/main/vrs/DataLayoutConventions.h#L59" target="_blank" rel="noopener noreferrer" class=""><code>vrs::DataLayoutConventions::ImageSpec</code></a> to describe your image in a configuration record, or in a <code>DataLayout</code> block just before the image content block of your data records.</p>
<p>The <code>DataLayout</code> fields are:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> width</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageWidth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> height</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageHeight</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> stride</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageStride</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> stride2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageStride2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceEnum</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">PixelFormat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> pixelFormat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImagePixelFormat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// For image/custom_codec and image/video only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceString codecName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageCodecName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> codecQuality</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageCodecQuality</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// optional</span><br></span></code></pre></div></div>
<p>For <code>image/video</code> images, specify the keyframe timestamp and the keyframe index, using the following <code>DataLayout</code> fields:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token keyword" style="font-style:italic">double</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> keyFrameTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageKeyFrameTimeStamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DataPieceValue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ImageSpecType</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> keyFrameIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">kImageKeyFrameIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="image-format-differences">Image Format Differences<a href="#image-format-differences" class="hash-link" aria-label="Direct link to Image Format Differences" title="Direct link to Image Format Differences" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="imageraw"><code>image/raw</code><a href="#imageraw" class="hash-link" aria-label="Direct link to imageraw" title="Direct link to imageraw" translate="no">​</a></h3>
<p>Without the following properties, <code>image/raw</code> image content blocks can not be interpreted:</p>
<ul>
<li class="">Required properties: width, height, pixel format.</li>
<li class="">Optional properties: stride, stride2.</li>
</ul>
<p>When properties are provided using the Datalayout Conventions, all additional properties must be provided by a single <code>DataLayout</code> structure in one record. For example, you must not put the pixel format in the configuration record, and then put the image dimensions in the data record. You must either put both the pixel format and the image dimensions in a configuration record&#x27;s <code>DataLayout</code>, or you must put them both in a <code>DataLayout</code> just before the image content block.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="imagepng-imagejpg-and-imagejxl"><code>image/png</code>, <code>image/jpg</code> and <code>image/jxl</code><a href="#imagepng-imagejpg-and-imagejxl" class="hash-link" aria-label="Direct link to imagepng-imagejpg-and-imagejxl" title="Direct link to imagepng-imagejpg-and-imagejxl" translate="no">​</a></h3>
<p>png, jpg, and jxl payloads are exactly the same as png, jpg, and jxl files, which are fully self-described. Therefore, when those image formats are used, properties specified using the Datalayout Conventions are ignored by VRS.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="imagecustom_codec"><code>image/custom_codec</code><a href="#imagecustom_codec" class="hash-link" aria-label="Direct link to imagecustom_codec" title="Direct link to imagecustom_codec" translate="no">​</a></h3>
<ul>
<li class="">Required properties: codec name.</li>
<li class="">Optional properties: width, height, pixel format, codec name, keyframe timestamp, keyframe index.</li>
</ul>
<p>The only property VRS itself requires is a codec name for an image content block to be recognized. However, a particular custom codec may require additional properties, such as width, height, and pixel format. Whether a custom codec requires that information or not an implementation detail of each specific custom codec. VRS does not support any particular custom codec by default, they are meant for experimentations and special cases.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="imagevideo"><code>image/video</code><a href="#imagevideo" class="hash-link" aria-label="Direct link to imagevideo" title="Direct link to imagevideo" translate="no">​</a></h3>
<p>Video image content blocks require additional properties to decode images:</p>
<ul>
<li class="">Required properties: width, height, pixel format, codec name, keyframe timestamp, keyframe index.</li>
<li class="">Optional properties: compression quality, which may affect how to decode the image.</li>
</ul>
<p>Similar to <code>image/raw</code> images, pixel format and image dimension information must be provided in a single <code>DataLayout</code>, either in the configuration record or in the data record of the image. Typically, the pixel format and image resolution will not change without a configuration change. Therefore, they are best stored in a configuration record.<br>
<!-- -->On the other hand, the keyframe timestamp and the keyframe index properties change with every frame, and are therefore searched only in a <code>DataLayout</code> that must be immediately before the <code>image/video</code> content block.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="reading-images">Reading Images<a href="#reading-images" class="hash-link" aria-label="Direct link to Reading Images" title="Direct link to Reading Images" translate="no">​</a></h2>
<p>Image data is received by the <code>RecordFormatStreamPlayer::onImageRead()</code> callback:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">onImageRead</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> CurrentRecord</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> record</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    size_t blockIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> ContentBlock</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> contentBlock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre></div></div>
<p>The <code>RecordFormatStreamPlayer::onDataLayoutRead()</code> callback happens <strong>after</strong> the <code>DataLayout</code> data has been read from disk.</p>
<p>The <code>RecordFormatStreamPlayer::onImageRead()</code> callback happens <strong>before</strong> any image data has been read. However, the provided <code>contentBlock</code> object holds all the image properties, so the following information can be found:</p>
<ul>
<li class="">For all types: the <code>contentBlock</code> size is known. That&#x27;s the size of the buffer you will need to read the image data stored in the image content block.</li>
<li class="">For <code>image/raw</code> images: resolution, strides, and pixel format are defined.</li>
<li class="">For <code>image/custom_codec</code> images: codec name is defined. Resolution, strides, and pixel format might be defined too, if provided in the stream using the Datalayout Conventions.</li>
<li class="">For <code>image/video</code> images: the pixel format, resolution, codec name, keyframe timestamp, and keyframe index are defined.</li>
</ul>
<p>The image data itself can be read using the <code>RecordReader</code> object provided by the <code>CurrentRecord</code> object. The image is described by an <code>ImageContentBlockSpec</code> object provided by <code>contentBlock.image()</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="imageraw-images"><code>image/raw</code> images<a href="#imageraw-images" class="hash-link" aria-label="Direct link to imageraw-images" title="Direct link to imageraw-images" translate="no">​</a></h3>
<p>Allocate or reuse a buffer where you can read the image data. Be careful to properly handle the image’s stride and stride2. <code>stride</code> describes the stride of the first plane (the number of bytes separating the first byte of each successive lines), while <code>stride2</code> describes the stride of all the following planes, if the images is stored in a multi-plane format.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="imagepng-imagejpg-and-imagejxl-images"><code>image/png</code>, <code>image/jpg</code>, and <code>image/jxl</code> images<a href="#imagepng-imagejpg-and-imagejxl-images" class="hash-link" aria-label="Direct link to imagepng-imagejpg-and-imagejxl-images" title="Direct link to imagepng-imagejpg-and-imagejxl-images" translate="no">​</a></h3>
<p>You will need to read and decode the compressed image data using a standard implementation.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="imagecustom_codec-images"><code>image/custom_codec</code> images<a href="#imagecustom_codec-images" class="hash-link" aria-label="Direct link to imagecustom_codec-images" title="Direct link to imagecustom_codec-images" translate="no">​</a></h3>
<p>You will need to read and decode the compressed image data using your own implementation of the custom codec, which implementation is presumably unknown to VRS.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="imagevideo-images"><code>image/video</code> images<a href="#imagevideo-images" class="hash-link" aria-label="Direct link to imagevideo-images" title="Direct link to imagevideo-images" translate="no">​</a></h3>
<p>Support for <code>image/video</code> images is provided by the vrs/xprs module, that depends on ffmpeg, and exposes the codecs built with it.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebookresearch/vrs/edit/main/website/docs/ImageSupport.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/vrs/docs/RecordFormat"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Record Format</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/vrs/docs/FileHandler"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">The FileHandler Interface</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#additional-image-properties" class="table-of-contents__link toc-highlight">Additional Image Properties</a><ul><li><a href="#specifying-additional-image-properties" class="table-of-contents__link toc-highlight">Specifying Additional Image Properties</a></li></ul></li><li><a href="#image-format-differences" class="table-of-contents__link toc-highlight">Image Format Differences</a><ul><li><a href="#imageraw" class="table-of-contents__link toc-highlight"><code>image/raw</code></a></li><li><a href="#imagepng-imagejpg-and-imagejxl" class="table-of-contents__link toc-highlight"><code>image/png</code>, <code>image/jpg</code> and <code>image/jxl</code></a></li><li><a href="#imagecustom_codec" class="table-of-contents__link toc-highlight"><code>image/custom_codec</code></a></li><li><a href="#imagevideo" class="table-of-contents__link toc-highlight"><code>image/video</code></a></li></ul></li><li><a href="#reading-images" class="table-of-contents__link toc-highlight">Reading Images</a><ul><li><a href="#imageraw-images" class="table-of-contents__link toc-highlight"><code>image/raw</code> images</a></li><li><a href="#imagepng-imagejpg-and-imagejxl-images" class="table-of-contents__link toc-highlight"><code>image/png</code>, <code>image/jpg</code>, and <code>image/jxl</code> images</a></li><li><a href="#imagecustom_codec-images" class="table-of-contents__link toc-highlight"><code>image/custom_codec</code> images</a></li><li><a href="#imagevideo-images" class="table-of-contents__link toc-highlight"><code>image/video</code> images</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/vrs/docs/Overview">Documentation</a></li><li class="footer__item"><a href="https://github.com/facebookresearch/vrs/tree/main/sample_code" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sample Code<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Legal (continued)</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Policy<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/vrs/img/oss_logo.png" alt="Facebook Open Source Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/vrs/img/oss_logo.png" alt="Facebook Open Source Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">Copyright © 2026 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>