<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VRS: vrs::Compressor Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="VRS-Icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VRS
   </div>
   <div id="projectbrief">A file format for sensor data.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacevrs.html">vrs</a></li><li class="navelem"><a class="el" href="classvrs_1_1_compressor.html">Compressor</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="classvrs_1_1_compressor-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">vrs::Compressor Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Helper class to compress data using lz4 or zstd presets.  
 <a href="classvrs_1_1_compressor.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_compressor_8h_source.html">Compressor.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvrs_1_1_compressor_1_1_compressor_impl.html">CompressorImpl</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvrs_1_1_compressor_1_1uninitialized__byte.html">uninitialized_byte</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0f3392bca10173a48683fd94fa4e1f87"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvrs_1_1_compressor.html#a0f3392bca10173a48683fd94fa4e1f87">compress</a> (const void *data, size_t dataSize, <a class="el" href="namespacevrs.html#a37a35edf18e8bb343398cb938d3e2b7b">CompressionPreset</a> preset, size_t headerSpace=0)</td></tr>
<tr class="separator:a0f3392bca10173a48683fd94fa4e1f87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e33c50e89e9ec077838c21d2f608b25"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvrs_1_1_compressor.html#a7e33c50e89e9ec077838c21d2f608b25">startFrame</a> (size_t frameSize, <a class="el" href="namespacevrs.html#a37a35edf18e8bb343398cb938d3e2b7b">CompressionPreset</a> zstdPreset, uint32_t &amp;outSize)</td></tr>
<tr class="separator:a7e33c50e89e9ec077838c21d2f608b25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9210b6c2c1205e2ad6292ed1f5835dbb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvrs_1_1_compressor.html#a9210b6c2c1205e2ad6292ed1f5835dbb">addFrameData</a> (<a class="el" href="classvrs_1_1_write_file_handler.html">WriteFileHandler</a> &amp;file, const void *data, size_t dataSize, uint32_t &amp;inOutCompressedSize, size_t maxCompressedSize=0)</td></tr>
<tr class="separator:a9210b6c2c1205e2ad6292ed1f5835dbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f661dc89e73af8a08af5ec6088303b2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvrs_1_1_compressor.html#a9f661dc89e73af8a08af5ec6088303b2">endFrame</a> (<a class="el" href="classvrs_1_1_write_file_handler.html">WriteFileHandler</a> &amp;file, uint32_t &amp;inOutCompressedSize, size_t maxCompressedSize=0)</td></tr>
<tr class="separator:a9f661dc89e73af8a08af5ec6088303b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe5afb3511ea2ede7b73354b237d70a5"><td class="memItemLeft" align="right" valign="top">const void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvrs_1_1_compressor.html#abe5afb3511ea2ede7b73354b237d70a5">getData</a> () const</td></tr>
<tr class="separator:abe5afb3511ea2ede7b73354b237d70a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac39727f9b1a0bc472f4dc587cbbeb314"><td class="memTemplParams" colspan="2"><a id="ac39727f9b1a0bc472f4dc587cbbeb314"></a>
template&lt;class HeaderType &gt; </td></tr>
<tr class="memitem:ac39727f9b1a0bc472f4dc587cbbeb314"><td class="memTemplItemLeft" align="right" valign="top">HeaderType *&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classvrs_1_1_compressor.html#ac39727f9b1a0bc472f4dc587cbbeb314">getHeader</a> ()</td></tr>
<tr class="memdesc:ac39727f9b1a0bc472f4dc587cbbeb314"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the space reserved for a header. <br /></td></tr>
<tr class="separator:ac39727f9b1a0bc472f4dc587cbbeb314"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a48717a464327cb3ecff499fcac81a4"><td class="memItemLeft" align="right" valign="top"><a id="a5a48717a464327cb3ecff499fcac81a4"></a>
<a class="el" href="namespacevrs.html#ac167a592f5255abc1a276d8ed0b96f2f">CompressionType</a>&#160;</td><td class="memItemRight" valign="bottom"><b>getCompressionType</b> () const</td></tr>
<tr class="separator:a5a48717a464327cb3ecff499fcac81a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25a6b98fb7a1ee28f77b623341c7b8b9"><td class="memItemLeft" align="right" valign="top"><a id="a25a6b98fb7a1ee28f77b623341c7b8b9"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvrs_1_1_compressor.html#a25a6b98fb7a1ee28f77b623341c7b8b9">clear</a> ()</td></tr>
<tr class="memdesc:a25a6b98fb7a1ee28f77b623341c7b8b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Really deallocate the buffer's memory (<a class="el" href="classvrs_1_1_compressor.html#a25a6b98fb7a1ee28f77b623341c7b8b9" title="Really deallocate the buffer&#39;s memory (clear() doesn&#39;t do that)">clear()</a> doesn't do that) <br /></td></tr>
<tr class="separator:a25a6b98fb7a1ee28f77b623341c7b8b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a30a79e34fcec77d81be14e81ccf3f5ed"><td class="memItemLeft" align="right" valign="top"><a id="a30a79e34fcec77d81be14e81ccf3f5ed"></a>
static bool&#160;</td><td class="memItemRight" valign="bottom"><b>shouldTryToCompress</b> (<a class="el" href="namespacevrs.html#a37a35edf18e8bb343398cb938d3e2b7b">CompressionPreset</a> preset, size_t size)</td></tr>
<tr class="separator:a30a79e34fcec77d81be14e81ccf3f5ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a9beadfb437da7ac2d24720480ca7ea82"><td class="memItemLeft" align="right" valign="top"><a id="a9beadfb437da7ac2d24720480ca7ea82"></a>
static const size_t&#160;</td><td class="memItemRight" valign="bottom"><b>kMinByteCountForCompression</b> = 250</td></tr>
<tr class="separator:a9beadfb437da7ac2d24720480ca7ea82"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Helper class to compress data using lz4 or zstd presets. </p>
<p>You can switch between presets at no cost. If presets don't work well enough with your data, you can easily experiment with new settings and add your own preset to CompressionPreset. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a9210b6c2c1205e2ad6292ed1f5835dbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9210b6c2c1205e2ad6292ed1f5835dbb">&#9670;&nbsp;</a></span>addFrameData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vrs::Compressor::addFrameData </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classvrs_1_1_write_file_handler.html">WriteFileHandler</a> &amp;&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dataSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t &amp;&#160;</td>
          <td class="paramname"><em>inOutCompressedSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>maxCompressedSize</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add data to a frame started before. The total amount of data may not exceed the declared size of the frame when it was started. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>A file open for writing. </td></tr>
    <tr><td class="paramname">data</td><td>A pointer to the data to add to the frame. </td></tr>
    <tr><td class="paramname">dataSize</td><td>Number of bytes to add to the frame. </td></tr>
    <tr><td class="paramname">inOutCompressedSize</td><td>Updated number of bytes written out to the file. </td></tr>
    <tr><td class="paramname">maxCompressedSize</td><td>Max number of bytes the compressed record may get. Fail if the compressed data is larger, while guarantying that fewer bytes have been written to disk. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 for success, or an error code. The input buffer may be recycled immediately, but all the data may not have been written out to the file yet. You may add all the data of the frame in as many calls as you wish, one byte at a time, all at once, and anything in between. </dd></dl>

</div>
</div>
<a id="a0f3392bca10173a48683fd94fa4e1f87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f3392bca10173a48683fd94fa4e1f87">&#9670;&nbsp;</a></span>compress()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t vrs::Compressor::compress </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dataSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacevrs.html#a37a35edf18e8bb343398cb938d3e2b7b">CompressionPreset</a>&#160;</td>
          <td class="paramname"><em>preset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>headerSpace</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compress some data using a specific preset. If the compression setting doesn't lead to a smaller payload, because the data can't be compressed, then the record won't be compressed at all. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Pointer to the data to compress. </td></tr>
    <tr><td class="paramname">dataSize</td><td>Number of bytes in the buffer to compress. </td></tr>
    <tr><td class="paramname">preset</td><td>Compression preset to use. </td></tr>
    <tr><td class="paramname">headerSpace</td><td>Number of bytes to reserve at the beginning of the buffer for a header initialized manually later. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of bytes of compressed data, or 0 in case of failure. </dd></dl>

</div>
</div>
<a id="a9f661dc89e73af8a08af5ec6088303b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f661dc89e73af8a08af5ec6088303b2">&#9670;&nbsp;</a></span>endFrame()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vrs::Compressor::endFrame </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classvrs_1_1_write_file_handler.html">WriteFileHandler</a> &amp;&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t &amp;&#160;</td>
          <td class="paramname"><em>inOutCompressedSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>maxCompressedSize</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write out all the data left in internal compression buffers to disk, and complete the frame. After this call has been made, a new frame maybe started. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>A file open for writing. </td></tr>
    <tr><td class="paramname">inOutCompressedSize</td><td>Updated number of bytes written out to the file. </td></tr>
    <tr><td class="paramname">maxCompressedSize</td><td>Max number of bytes the compressed record may get. Fail if the compressed data is larger, while guarantying that fewer bytes have been written to disk. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 for success, or an error code. After this call, inOutSize counts the total number of bytes used for the compressed frame, including compression metadata. This number should be smaller than the frame size, but might be slightly larger, if the data couldn't be compressed. </dd></dl>

</div>
</div>
<a id="abe5afb3511ea2ede7b73354b237d70a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe5afb3511ea2ede7b73354b237d70a5">&#9670;&nbsp;</a></span>getData()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const void* vrs::Compressor::getData </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the compressed data after compression. The size to consider was returned by <a class="el" href="classvrs_1_1_compressor.html#a0f3392bca10173a48683fd94fa4e1f87">compress()</a>. </p><dl class="section return"><dt>Returns</dt><dd>Pointer to the compressed data. </dd></dl>

</div>
</div>
<a id="a7e33c50e89e9ec077838c21d2f608b25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e33c50e89e9ec077838c21d2f608b25">&#9670;&nbsp;</a></span>startFrame()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vrs::Compressor::startFrame </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>frameSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacevrs.html#a37a35edf18e8bb343398cb938d3e2b7b">CompressionPreset</a>&#160;</td>
          <td class="paramname"><em>zstdPreset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t &amp;&#160;</td>
          <td class="paramname"><em>outSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Frame compression APIs, with streaming to a file. Write to a file a block of data (a "frame") to be compressed. That data will be logically self contained, and its size will be retrievable when decoding the first byte. The frame can be added in multiple calls, making it easy to write a lot of data without needing large intermediate buffers.</p>
<p>Start a new frame, declaring its full size upfront. This size must be respected. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">frameSize</td><td>exact number of bytes that will be added to the frame in total. </td></tr>
    <tr><td class="paramname">zstdPreset</td><td>compression preset to use. Only zstd presets are supported by this API. </td></tr>
    <tr><td class="paramname">outSize</td><td>total number of compressed bytes written. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 for success, or an error code. This call initializes outSize to 0. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>vrs/<a class="el" href="_compressor_8h_source.html">Compressor.h</a></li>
<li>vrs/Compressor.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
