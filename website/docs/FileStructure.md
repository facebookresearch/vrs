---
sidebar_position: 3
title: File Structure
---

## File Tags
VRS files contain **file tags**, which simply a set of name-value pairs, both of which a text strings. File tags may mean anything, but VRS defines
[some tag conventions](https://github.com/facebookresearch/vrs/blob/main/vrs/TagConventions.h) to represent a few common concepts.

## Streams
A VRS file contains multiple streams, each associated with a *device type*, defined by the
[`RecordableTypeId`](https://github.com/facebookresearch/vrs/blob/main/vrs/StreamId.h) enum and maybe a «Recordable Flavor».
A `RecordableTypeId` maybe paired with a «Recordable Flavor» represent the type of device or data contained in that stream.

A device type can also represent a virtual device, such as the output of a vision algorithm, or some events (such as keyboard/mouse/orientation events) that we want to use to exercise some code.

## Stream Tags
Streams also have tags, which simply a set of name-value pairs, both of which a text strings. Stream tags may mean anything, but the
[tag conventions](https://github.com/facebookresearch/vrs/blob/main/vrs/TagConventions.h) can be used for streams to represent a few common concepts.

## Records
Streams contain a time sorted sequence of records. For each stream, there are 3 types of records: **Configuration**, **State** and **Data** records.

Every record has its own:

* **Timestamp**
* Device type id (a `RecordableTypeId`) and an instance id forming a `StreamId`, unique in the file for that device type id. Instance ids are generated by VRS.
* Record type: **Configuration**, **State** or **Data**.
* Record format version (int32), which ties the record to its `RecordFormat`, or that the reader will need to recognize to interpret the data inside (pre-`RecordFormat` legacy style).

Timestamps are `double` values, counting a number of seconds since some arbitrary point in time (EPOCH, boot time, or any other fixed point).

:::note
*All the records of a VRS file **must use timestamps in the same time domain**, because that's how VRS will sort the records in the file and for playback.*

If your data has device specific timestamps (images and IMU samples might come with their own device specific timestamps), save those timestamps inside the records.
:::

Timestamps are using the `double` type, because this is how time is represented in the Oculus world. This type is awkward for many newcomers (including yours trully initially), but it often turns out to be a forcing function for clarity on what the VRS time source should be. It is commonly the case that devices (cameras, IMU, etc) will have their own internal clock or counters which aren't synchronized, and using `double` can help avoid confusing VRS timestamps and device specific time domains.  

:::caution
If you are considering recording audio, be aware that audio devices are defacto clocks, since they will produce data at a specific sample rate. If you use a system clock as the clock for your VRS records, that clock and your audio clock are bound to drift, making it difficult to accurately synchronize audio data with your other data (images in particular). You can (usually) easily establish a correspondance between your system clock and the first audio sample when you start recording, but then, 10 minutes down the road, your system clock and the audio clock (as determined by the count of audio samples produced divided by the sample rate) will no longer be in sync in a visible way.  
Be extremely careful when trying to find which audio sample corresponds to a particular image, as this is likely to be very challenging to accomplish reliably, and never as accurate as you wish it were.
:::


### Configuration Records
**Configuration records** describe how the device is configured. Example: the resolution & exposure settings of a camera. This could also be how an algorithm is configured. The configuration of a device is expected to be somewhat stable, that is, not change at every moment, but configuration records are also not meant to store parameters that never change, like a serial number. For parameters that can not change (like a serial number), prefer to use stream tags, which can be queried directly as soon as a VRS file is open for reading.

### State Records
**State records** are meant to store the state of a device. For physical devices, it’s probably not very useful, but for algorithms, it is meant to store the algorithm's internal state at different instants, as it could be the result of previous calculations affecting behaviors. For a vision algorithm, it could be features it is tracking at the moment, where they are in space, etc. While the state of a device might be changing at any time, in particular when data is processed, for performance reasons, we probably do not want to record each individual state. Recording the state of a device is important to allow to jump back in time without having to replay the entire session.

Note that typically, state records are empty, because the internal state of devices is not commonly tracked.

### Data Records
**Data records** contain data that flows out of the device or algorithm. For cameras, it’s probably images, for an IMU device, it’s probably a set of sensor samples, for a vision algorithm, it might be a pose. The implementer of a device is responsible for the format of that data, and can include metadata as well, such as internal counters, timestamps and other measurements. Use `RecordFormat` & `DataLayout` to make your record's format interoperable.

